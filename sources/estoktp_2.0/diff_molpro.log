34c34
<       character*200 comline1
---
>       character*500 comline1
125c125
<       read (11,'(A200)') comline1
---
>       read (11,'(A)') comline1
176c176
<             read(99,'(A200)')comline1
---
>             read(99,'(A)')comline1
183c183
<                   read(15,'(A200)')comline1
---
>                   read(15,'(A100)')comline1
207c207
< c      write (10,*) 'SET,SPIN=',ispin-1
---
>       write (10,*) 'SET,SPIN=',ispin-1
209c209
< c      if(iaspace.eq.1)write (98,*)'SET,SPIN=',ispin-1
---
>       if(iaspace.eq.1)write (98,*)'SET,SPIN=',ispin-1
213c213
<       read (11,'(A200)') comline1
---
>       read (11,'(A)') comline1
222,223d221
<             write (10,*) 'SET,SPIN=',ispin-1
<             write (98,*) 'SET,SPIN=',ispin-1
227c225
<                read(15,'(A200)')comline1
---
>                read(15,'(A100)')comline1
243c241
<                read(15,'(A200)')comline1
---
>                read(15,'(A90)')comline1
245,246d242
<             write (10,*) 'SET,SPIN=',ispin-1
<             write (98,*) 'SET,SPIN=',ispin-1
253,292d248
<       if(iaspace.eq.1.and.word2.eq.'ACTIVE_SPACE2_T')then
< c        if(ispin.eq.1)then
<             open(unit=15,file='activespace.dat',status='unknown')
<             read(15,*)nlines
<             do j=1,nlines
<                read(15,'(A200)')comline1
<             enddo
<             read(15,'(A100)')
<             read(15,'(A200)')comline1
<             write (10,*) 'SET,SPIN=',ispin+1
<             write (10,*) comline1
<             write (98,*) 'SET,SPIN=',ispin+1
<             write (98,*) comline1
<             close(15)
< c         endif
<          goto 101
<       endif
< 
<       if(iaspace.eq.1.and.word2.eq.'ACTIVE_SPACE2_RHF')then
< c        if(ispin.eq.1)then
<             open(unit=15,file='activespace.dat',status='unknown')
<             read(15,*)nlines
<             do j=1,nlines
<                read(15,'(A200)')comline1
<             enddo
<             read(15,'(A100)')
<             read(15,'(A100)')
<             read(15,'(A200)')comline1
<             write (10,*) 'SET,SPIN=2'
<             write (98,*) 'SET,SPIN=2'
<             write (10,*) comline1
<             write (98,*) comline1
<             read(15,'(A200)')comline1
<             write (10,*) comline1
<             write (98,*) comline1
<             close(15)
< c         endif
<          goto 101
<       endif
< 
312c268
<       read (11,'(A200)') comline1
---
>       read (11,'(A)') comline1
324c280
<                read(15,'(A200)')comline1
---
>                read(15,'(A100)')comline1
329d284
<             write(98,*)'Skip'
342,356c297
<                read(15,'(A200)')comline1
<             enddo
<             write (10,*) comline1
<             write (98,*) comline1
<             close(15)
< c         endif
<          goto 301
<       endif
< 
<       if(iaspace.eq.1.and.word2.eq.'ACTIVE_SPACE2_T')then
< c        if(ispin.eq.1)then
<             open(unit=15,file='activespace.dat',status='unknown')
<             read(15,*)nlines
<             do j=1,nlines
<                read(15,'(A200)')comline1
---
>                read(15,'(A100)')comline1
358,359d298
<             read(15,'(A100)')
<             read(15,'(A200)')comline1
367,384d305
<       if(iaspace.eq.1.and.word2.eq.'ACTIVE_SPACE2_RHF')then
< c        if(ispin.eq.1)then
<             open(unit=15,file='activespace.dat',status='unknown')
<             read(15,*)nlines
<             do j=1,nlines
<                read(15,'(A200)')comline1
<             enddo
<             read(15,'(A100)')
<             read(15,'(A100)')
<             read(15,'(A200)')comline1
<             write (10,*) comline1
<             write (98,*) comline1
<             close(15)
< c         endif
<          goto 301
<       endif
< 
< 
492,494c413
<       command1='rm -f temp1.log temp2.log temp3.log temp4.log temp.log'
<       call commrun(command1)
<       command1='egrep CBSEN molpro.out > temp1.log'
---
>       command1='egrep -w CBSEN molpro.out > temp1.log'
498,504c417
<       command1='egrep CBSENINT molpro.out > temp2.log'
<       call commrun(command1)
<       command1='head -n 1 temp2.log > temp3.log'
<       call commrun(command1)
<       command1='cat temp1.log temp3.log > temp4.log'
<       call commrun(command1)
<       command1='tail -n 1 temp4.log > temp.log'
---
>       command1='tail -n 1 temp1.log > temp.log'
511,513d423
<       command1='rm -f temp1.log temp2.log temp3.log temp4.log temp.log'
<       call commrun(command1)
< c      stop
690c600
<          do j=1,natomt
---
>          do j=1,natom
718,721c628
<             if(atomtype(j).ne.'X')then
<                write(101,1002)j,ianumb,0,coox(j),cooy(j),cooz(j)
<             endif
< c            if(atomtype(j).eq.'X')j=j-1
---
>             write(101,1002)j,ianumb,0,coox(j),cooy(j),cooz(j)
784c691
<          do j=1,natomt
---
>          do j=1,natom
812,814c719
<             if(atomtype(j).ne.'X')then
<                write(101,1001)j,ianumb,gradx(j),grady(j),gradz(j)
<             endif
---
>             write(101,1001)j,ianumb,gradx(j),grady(j),gradz(j)
942c847
<       subroutine readgrad_molpro(nvar,atomlabel,grad)
---
>       subroutine readgrad_molpro(nvar,grad)
959,961d863
<       character*60 atomlabel(natommx)
<       character*60 atomlabelg(natommx)
< 
986,988d887
<          do i = 1 , nvar
<             grad(i)=0.                
<          enddo
990,996c889,890
<             read(11,*)atomlabelg(iread),cjunk,cjunk,cjunk,cjunk,gradval
< c            grad(iread)=gradval
<             do ik=1,nvar
<                if(atomlabelg(iread).eq.atomlabel(ik))then
<                   grad(ik)=gradval                  
<                endif
<             enddo
---
>             read(11,*)cjunk,cjunk,cjunk,cjunk,cjunk,gradval
>             grad(iread)=gradval
1000,1003d893
< c         do i = 1 , nvar
< c            write(*,*)i,atomlabel(i),atomlabelg(i),grad(i)
< c         enddo
< c         stop
1042d931
<       isk=0
1049,1055c938
< cc read energy
< 
<       if((WORD.EQ.'SETTING').AND.(WORD2.EQ.'CBSENINT').
<      + AND.(ISK.EQ.0))then
<          read(word4,100)En1
<          isk=1
<       endif
---
> cc read gradient in internal coordinates
1057c940
<       if((WORD.EQ.'SETTING').AND.(WORD2.EQ.'CBSEN').AND.(ISK.EQ.0))then
---
>       if((WORD.EQ.'SETTING').AND.(WORD2.EQ.'CBSEN'))then
1060a944,945
>  100     format (F14.7)
> 
1072d956
<  100     format (F14.7)
